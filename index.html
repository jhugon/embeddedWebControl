<!DOCTYPE html>
<html><head><title>Mbed Webserver</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>
    <h1>Mbed Webserver</h1>
    <button id="toggle">Toggle LED</button>
    <h2>Variable Table</h2>
    <table id="vartable" class="table">
      <tr>
        <th>Name</th>
        <th>Memory Address</th>
        <th>Type</th>
        <th>Value</th>
        <th>Description</th>
      </tr>
      <tr>
        <td>Name</td>
        <td>Memory Address</td>
        <td>Type</td>
        <td>Value</td>
        <td>Description</td>
      </tr>
    </table>
    <h2>Function Table</h2>
    <table id="funtable" class="table">
      <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Input</th>
        <th>Output</th>
      </tr>
      <tr>
        <td class="funcname">Name</td>
        <td>Description</td>
        <td><input></input><button class="funcsend btn btn-primary">Send</button></td>
        <td class="funcoutput"></td>
      </tr>
    </table>
</body>
<script>
    document.querySelector('.funcsend').onclick = function() {
        console.log("Clicked on button!!")
        console.log(event)
        console.log(event.target)
        var whichbutton = event.target
        var inputElem = whichbutton.parentNode.querySelector("input");
        var message = inputElem.value;
        var row = whichbutton.parentNode.parentNode;
        var outputElem = row.querySelector('.funcoutput')
        var funcname = row.querySelector('.funcname').innerHTML
        console.log(row)
        console.log(outputElem)
        console.log("funcname:")
        console.log(funcname)
        console.log("message:")
        console.log(message)
        var req = new XMLHttpRequest()
        req.open('POST', '/fun/'+funcname)
        req.onreadystatechange = function() {
          if(this.readyState == 4) {
            if(this.status == 200) {
              outputElem.className = "";
              outputElem.innerHTML = req.responseText;
            }
            else {
              outputElem.className = "table-danger";
              outputElem.innerHTML = "HTTP Error: "+this.status;
            }
          }
        }
        req.timeout = 1000
        req.ontimeout = function() {
          outputElem.className = "table-warning";
          outputElem.innerHTML = '<span class="error">HTTP Timeout</span>'
        }
        req.send(message)
    }
</script>
</html>
